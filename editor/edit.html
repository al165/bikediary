<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
</head>

<body>
    <div id="liveAlertPlaceholder"></div>
    <div class="container mt-4">
        <div class="card" style="width: 18rem">
            <div class="card-header">Update Planned Route</div>
            <div class="card-body">
                <form action="/upload_gpx" method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="upload-gpx" class="form-label">Planned GPX</label>
                        <input type="file" name="gpx_file" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                    <a href="/remove_gpx" class="btn btn-warning">Remove</a>
                </form>
            </div>
        </div>
        <div class="card mt-4">
            <div class="card-header">Upload Photo</div>
            <div class="card-body">
                <form action="/upload_photo" method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <input type="file" name="photo_file" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
                <div id="photo-list" class="mt-4" style="display: flex; flex-wrap: wrap;">
                </div>

            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // get all uploaded images
        async function getPhotos() {
            const res = await fetch('/all_photos');
            const photos = await res.json();

            let html = [];
            for (const photo of photos) {
                let card =
                    `<div class="card m-1" style="width: 8rem;">` +
                    `<img class="card-img-top" src="/photos/thumb/${photo.name}">` +
                    `<div class="card-body">` +
                    `<p class="card-text">Lat: ${photo.latitude} Long: ${photo.longitude}</p>` +
                    `<form action="/remove_photo" method="POST">` +
                    `<button class="btn btn-warning btn-sm" type="submit" name="photo_id" value="${photo.id}"><i class="bi-x-lg"></i></button>` +
                    `</form>` +
                    `</div> ` +
                    `</div >`;

                html.push(card);
            }
            document.querySelector("#photo-list").innerHTML = html.join('\n');
        }

        // window.onload(() => getPhotos());
        getPhotos();

        function addAlert(message, type) {
            const alertPlaceholder = document.getElementById('liveAlertPlaceholder')
            const wrapper = document.createElement('div')
            wrapper.innerHTML = [
                `<div class="alert alert-${type} alert-dismissible" role="alert">`,
                `   <div>${message}</div>`,
                '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                '</div>'
            ].join('');

            alertPlaceholder.append(wrapper);
        }

        socket.on('success', (msg) => {
            addAlert('success', msg);
        });

        socket.on('warning', (msg) => {
            addAlert('warning', msg);
        });

        socket.on('error', (msg) => {
            addAlert('danger', msg);
        })

    </script>

</body>

</html>